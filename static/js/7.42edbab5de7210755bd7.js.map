{"version":3,"sources":["webpack:///src/components/tool/Scripts.vue","webpack:///./src/components/tool/Scripts.vue?1ce9","webpack:///./src/components/tool/Scripts.vue"],"names":["Scripts","name","data","filer","codeContainerRef","blankScript","match","desc","author","scripts","active","userScripts","cardModal","shown","activeIndex","markdownContent","editor","computed","bodyStyles","this","$store","state","scriptsContainerStyles","height","scriptsInnerStyles","localStorageKeys","created","_this","asyncToGenerator_default","regenerator_default","a","mark","_callee","that","isMac","wrap","_context","prev","next","utils","getItem","t0","sent","navigator","platform","$nextTick","window","onkeydown","ev","$route","metaKey","keyCode","confirmModify","closeModal","preventDefault","ctrlKey","chrome","runtime","onMessage","addListener","request","sender","sendResponse","action","_s","getScritps","location","length","stop","mounted","methods","_userScripts","outScript","i","trim","split","some","item","replace","push","formatScripts","getScriptsConfig","beautifyCode","_this2","setTimeout","ele","$refs","innerHTML","__webpack_require__","e","then","__WEBPACK_AMD_REQUIRE_ARRAY__","CodeMirror","assign_default","value","theme","mode","lineNumbers","lineWrapping","styleActiveLine","foldGutter","matchBrackets","gutters","matchTags","bothTags","keyMap","on","evt","doc","getValue","apply","catch","oe","saveData","callback","webkitPersistentStorage","requestQuota","grantedBytes","webkitRequestFileSystem","PERSISTENT","fs","root","getFile","create","fileEntry","createWriter","fileWriter","onwriteend","console","log","onerror","toString","bb","Blob","stringify_default","type","write","errorCode","alert","getCurrentTabId","tabs","query","currentWindow","id","sendMessageToContentScript","message","tabId","sendMessage","response","initFiler","_this3","promise_default","resolve","Filer","init","filerErrorCallback","getHost","str","imgLoadError","target","setAttribute","openModal","Number","dataset","index","JSON","parse","splice","resetCardModal","saveUserScripts","$Message","success","removeScript","_this4","_callee2","_context2","addScript","removeUserScriptCard","_this5","stopPropagation","$Modal","confirm","title","content","okText","cancelText","onOk","createNewCard","toggleUserScriptStatus","_index","_this6","_callee3","_context3","setItem","tool_Scripts","render","_vm","_h","$createElement","_c","_self","staticClass","style","_l","key","attrs","bordered","data-index","click","src","error","_v","class","pen","placement","transfer","max-width","color","size","fullscreen","on-ok","on-cancel","model","$$v","$set","expression","ref","staticRenderFns","Component","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/7.42edbab5de7210755bd7.js","sourcesContent":["<template>\n  <div class=\"scripts_container\"\n       :style=\"scriptsContainerStyles\">\n    <div class=\"scripts_inner\"\n         :style=\"scriptsInnerStyles\">\n      <Card :bordered=\"false\"\n            class=\"user_script_item\"\n            v-for=\"(item, index) in userScripts\"\n            :key=\"index\">\n        <div class=\"user_script_card_inner\"\n             :data-index=\"index\"\n             @click=\"openModal\">\n          <img class=\"site_favicon_img pen\"\n               :src=\"'http://' + getHost(item.match) + '/favicon.ico'\"\n               @error=\"imgLoadError\">\n          <Tooltip class=\"pen\"\n                   :content=\"item.desc\"\n                   :class=\"{pen: !item.desc}\"\n                   placement=\"bottom\"\n                   :transfer=\"true\"\n                   :max-width=\"250\">\n            <div class=\"user_script_card_desc pea\"\n                 :data-index=\"index\"\n                 @click=\"openModal\">{{item.desc || '暂无描述'}}</div>\n          </Tooltip>\n          <div class=\"script_card_operations\">\n            <Tooltip content=\"删除脚本\"\n                     placement=\"bottom\"\n                     :transfer=\"true\"\n                     class=\"delete_script_card\">\n              <Icon type=\"md-trash\"\n                    color=\"#ed4014\"\n                    size=\"18\"\n                    :data-index=\"index\"\n                    @click=\"removeUserScriptCard\" />\n            </Tooltip>\n            <Tooltip :content=\"item.active ? '关闭脚本' : '开启脚本'\"\n                     placement=\"bottom\"\n                     :transfer=\"true\"\n                     class=\"delete_script_card\">\n              <Icon type=\"ios-bulb\"\n                    :color=\"item.active ? 'lightgray' : '#19be6b'\"\n                    size=\"18\"\n                    :data-index=\"index\"\n                    @click=\"toggleUserScriptStatus\" />\n            </Tooltip>\n          </div>\n        </div>\n        <div class=\"user_script_card_item_status pen\"\n             :class=\"{active: item.active}\">\n          <div class=\"status_text\">{{item.active ? 'ON' : 'OFF'}}</div>\n        </div>\n      </Card>\n      <Card :bordered=\"false\"\n            class=\"user_script_item\">\n        <div class=\"user_script_card_inner\"\n             @click=\"createNewCard\">\n          <Icon type=\"md-add\"\n                size=\"50\" />\n        </div>\n      </Card>\n    </div>\n\n    <Modal v-model=\"cardModal.shown\"\n           title=\"修改\"\n           @on-ok=\"confirmModify\"\n           @on-cancel=\"resetCardModal\"\n           :fullscreen=\"true\">\n      <div class=\"code_container\">\n        <div class=\"code_preview\"\n             :ref=\"codeContainerRef\"></div>\n      </div>\n      <!-- <Form :label-width=\"80\" :model=\"cardModal.data\">\n\t        \t<FormItem label=\"匹配域名\">\n\t        \t\t<Input type=\"text\" placeholder=\"请输入匹配的域名\" v-model=\"cardModal.data.match\"/>\n\t        \t</FormItem>\n\t        \t<FormItem label=\"脚本描述\">\n\t        \t\t<Input type=\"textarea\" class=\"no-resize\" placeholder=\"请输入脚本描述, 最多80字\" :maxlength=\"80\" :autosize=\"{ minRows: 2, maxRows: 4 }\" v-model=\"cardModal.data.desc\"/>\n\t        \t</FormItem>\n\t        \t<FormItem label=\"用户脚本\">\n\t        \t\t<Button type=\"primary\" ghost>点击修改</Button>\n\t        \t</FormItem>\n\t        </Form> -->\n    </Modal>\n  </div>\n</template>\n<style scoped>\n.code_container {\n  position: relative;\n  width: 100%;\n  min-height: 100%;\n}\n.code_preview {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n}\n.pen {\n  pointer-events: none;\n}\n.pea {\n  pointer-events: auto;\n}\n.scripts_container {\n  width: 100%;\n  /*background-color: rgba(255, 255, 255, .9);*/\n}\n.scripts_container * {\n  -webkit-user-select: none;\n}\n.scripts_inner {\n  /*width: 100%;*/\n  padding: 15px;\n  box-sizing: border-box;\n  overflow-y: auto;\n  /*display: flex;\n\t\tflex-direction: row;\n\t\tflex-wrap: wrap;*/\n}\n.user_script_item {\n  position: relative;\n  width: 250px;\n  height: 150px;\n  cursor: pointer;\n  margin: 5px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease-in-out;\n  opacity: 0.8;\n  overflow: hidden;\n}\n.user_script_item:hover {\n  opacity: 1;\n}\n.user_script_card_inner {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n}\n.script_card_operations {\n  position: absolute;\n  left: 10px;\n  top: 10px;\n}\n.delete_script_card {\n  transition: opacity 0.2s ease-in-out;\n  opacity: 0;\n}\n.user_script_item:hover .delete_script_card {\n  opacity: 1;\n}\n.user_script_card_item_status {\n  position: absolute;\n  right: 0;\n  top: 0;\n  width: 0;\n  height: 0;\n  border-top: 20px solid #ed4014;\n  border-right: 25px solid #ed4014;\n  border-left: 25px solid transparent;\n  border-bottom: 20px solid transparent;\n}\n.user_script_card_item_status.active {\n  border-top: 20px solid #19be6b;\n  border-right: 25px solid #19be6b;\n}\n.user_script_card_item_status .status_text {\n  font-size: 12px;\n  position: absolute;\n  left: -13px;\n  top: -15px;\n  width: 50px;\n  height: 20px;\n  transform: rotate(39deg);\n  color: #fff;\n  font-weight: bolder;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.user_script_card_item_status_2 {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 5px;\n  background-color: darkcyan;\n}\n.site_favicon_img {\n  width: 32px;\n  height: 32px;\n}\n.user_script_card_desc {\n  width: 100%;\n  max-height: 50px;\n  line-height: 25px;\n  margin-top: 20px;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  -webkit-line-clamp: 2;\n  word-break: break-all;\n  padding: 0 15px;\n  box-sizing: border-box;\n}\n\n.user_scripts_wrapper {\n  width: 100%;\n  min-height: 32px;\n}\n.user_scripts_wrapper .script_item {\n  width: 100%;\n  height: 32px;\n  margin-top: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n}\n.user_scripts_wrapper .script_item:first-child {\n  margin-top: 0;\n}\n.user_scripts_wrapper .script_item .script_input {\n  width: calc(100% - 40px);\n}\n.user_scripts_wrapper .script_item .script_item_operate {\n  width: 40px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.user_scripts_wrapper .script_item .script_item_operate .item_operation {\n  cursor: pointer;\n  transform: scale(1);\n  transition: all 0.1s cubic-bezier(0.215, 0.61, 0.355, 1);\n}\n.user_scripts_wrapper .script_item .script_item_operate .item_operation:hover {\n  transform: scale(1.2);\n}\n.user_scripts_wrapper .script_item .script_item_operate .remove_operation {\n  color: #ed4014;\n}\n.user_scripts_wrapper .script_item .script_item_operate .add_operation {\n  color: #19be6b;\n}\n</style>\n<script>\n// const Filer = require('filer.js')\n// /**\n//  * @author\t{{{AUTHOR}}}\n//  * @match\t*.baidu.com*\n//  * @desc \t测试弹框\n//  */\n\n//  (function () {\n// \t// 输入代码...\n//    // document.body.innerHTML = 'TEST!!!!!!!'\n//    // document.body.style.backgroundColor = 'darkcyan'\n//    // document.body.style.color = '#FFF'  \n//    if (location.href.match(/baidu\\.com\\/?$/)) {\n//     document.querySelector('#kw').value = '摩斯密码'\n//   \tdocument.querySelector('#su').click()\n//   } else if (location.href.match(/hao123\\.com\\/?$/)) {\n//   \tdocument.querySelector('[data-hook=searchInput]').value = '搞飞机'\n//     document.querySelector('[data-hook=searchSubmit]').click()\n//   } else {\n//     document.querySelector('.c-container').querySelector('a').click()\n//   }\n//  })()\n// import CodeMirror from 'CodeMirror'\nimport { StorageUtil } from '../../utils/index.js'\nexport default {\n  name: 'scripts',\n  data () {\n    return {\n      filer: null,\n      codeContainerRef: 'code-container-ref',\n      blankScript: {\n        match: '',\n        desc: '',\n        author: '',\n        scripts: `/**\n* @author\t{{{AUTHOR}}}\n* @match\t{{{MATCH}}}\n* @desc \t{{{DESC}}}\n*/\n\n(function () {\n\t// 输入代码...\n})()\n`,\n        active: false\n      },\n      userScripts: [],\n      cardModal: {\n        shown: false,\n        data: {}\n      },\n      activeIndex: -1,\n      markdownContent: '',\n      editor: {}\n    }\n  },\n  computed: {\n    bodyStyles () {\n      return this.$store.state.bodyStyles\n    },\n    scriptsContainerStyles () {\n      return {\n        height: (this.bodyStyles.height - 65) + 'px'\n      }\n    },\n    scriptsInnerStyles () {\n      return {\n        height: (this.bodyStyles.height - 65) + 'px'\n      }\n    },\n    localStorageKeys () {\n      return this.$store.state.localStorageKeys\n    }\n  },\n  async created () {\n    const that = this\n\n    this.userScripts = await StorageUtil.getItem(this.localStorageKeys.userScripts) || []\n\n    let isMac = (navigator.platform === 'Mac68K') || (navigator.platform === 'MacPPC') || (navigator.platform === 'Macintosh') || (navigator.platform === 'MacIntel')\n\n    this.$nextTick(() => {\n      window.onkeydown = function (ev) {\n        if (that.$route.name === 'scripts') {\n          if (isMac) {\n            if (ev.metaKey && ev.keyCode === 83) {\n              // 保存\n              that.confirmModify()\n              that.closeModal()\n              ev.preventDefault()\n            }\n          } else {\n            if (ev.ctrlKey && ev.keyCode === 83) {\n              that.confirmModify()\n              that.closeModal()\n              ev.preventDefault()\n            }\n          }\n        }\n      }\n      chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {\n        if (request.action === 'userscript') {\n          let _s = that.getScritps({\n            location: request.location\n          })\n          if (_s.length > 0) {\n            sendResponse(_s)\n          }\n        }\n      })\n    })\n    // chrome.extension.sendMessage({message: 'Hello'})\n  },\n  mounted () {\n    const that = this\n  },\n  methods: {\n    getScritps (data) {\n      let _userScripts = this.userScripts\n      let outScript = []\n      let i = 0\n      for (i; i < _userScripts.length; i++) {\n        if (_userScripts[i].match && _userScripts[i].match.trim() !== '') {\n          if (_userScripts[i].active && _userScripts[i].match.split(';').some(item => data.location.match(item.replace(/\\*/g, '.*')))) {\n            outScript.push(_userScripts[i])\n          }\n        }\n      }\n      return outScript\n    },\n    formatScripts (scripts) {\n      return scripts.replace(/{{{AUTHOR}}}/, 'YOU')\n        .replace(/{{{MATCH}}}/, this.cardModal.data.match)\n        .replace(/{{{DESC}}}/, this.cardModal.data.desc)\n    },\n    getScriptsConfig () {\n      let scripts = this.cardModal.data.scripts\n      let _s = scripts.replace(/[\\r\\n]/g, '###')\n      this.cardModal.data.author = _s.replace(/(.*@author\\s+)([^(###)]*)(###.*)/, '$2')\n      this.cardModal.data.match = _s.replace(/(.*@match\\s+)([^(###)]*)(###.*)/, '$2')\n      this.cardModal.data.desc = _s.replace(/(.*@desc\\s+)([^(###)]*)(###.*)/, '$2')\n    },\n    beautifyCode () {\n      const that = this\n      setTimeout(() => {\n        let ele = this.$refs[this.codeContainerRef]\n        ele.innerHTML = ''\n        require([\n          'codemirror/lib/codemirror',\n          'codemirror/mode/javascript/javascript',\n          'codemirror/addon/comment/comment',\n          'codemirror/addon/fold/foldcode',\n          'codemirror/addon/fold/foldgutter',\n          'codemirror/addon/fold/markdown-fold',\n          'codemirror/addon/fold/xml-fold',\n          'codemirror/addon/fold/comment-fold',\n          'codemirror/addon/fold/brace-fold',\n          'codemirror/addon/edit/closebrackets',\n          'codemirror/addon/edit/closetag',\n          'codemirror/addon/edit/matchtags',\n          'codemirror/keymap/sublime'\n        ], function (CodeMirror) {\n          that.editor = CodeMirror(ele, Object.assign({\n            value: that.cardModal.data.scripts || that.formatScripts(that.blankScript.scripts)\n          }, {\n              theme: 'zenburn',\n              mode: 'javascript',\n              lineNumbers: true,\n              lineWrapping: true,\n              styleActiveLine: true,\n              foldGutter: true,\n              matchBrackets: true,\n              gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter'],\n              matchTags: { bothTags: true },\n              keyMap: 'sublime'\n            }))\n\n          that.editor.on('change', function (evt) {\n            that.cardModal.data.scripts = evt.doc.getValue()\n            that.getScriptsConfig()\n            // let fileSuffix = that.currentFileName.replace(/^.+\\.(.+)$/, '$1').toLowerCase()\n            // if (fileSuffix === 'md') {\n            //   that.markdownContent = marked(evt.doc.getValue())\n            // }\n          })\n        })\n      }, 10)\n    },\n    saveData (callback) {\n      const that = this\n      navigator.webkitPersistentStorage.requestQuota(5 * 1024 * 1024,\n        function (grantedBytes) {\n          window.webkitRequestFileSystem(window.PERSISTENT, 5 * 1024 * 1024, function (fs) {\n            fs.root.getFile('userScripts.txt', { create: true }, function (fileEntry) {\n              fileEntry.createWriter(function (fileWriter) {\n                fileWriter.onwriteend = function (e) {\n                  console.log('write completed.', e)\n                  callback && callback()\n                }\n                fileWriter.onerror = function (e) {\n                  console.log('write failed: ' + e.toString())\n                }\n\n                let bb = new Blob([JSON.stringify(that.userScripts)], { type: 'text/plain' })\n                fileWriter.write(bb)\n              }, function (e) {\n                console.log('create wirter error: ', e.toString())\n              })\n            }, function (e) {\n              console.log('error: ', e.toString())\n            })\n          }, function (e) {\n            console.log('webkitRequestFileSystem error: ', e.toString())\n          })\n        },\n        function (errorCode) {\n          alert(\"Storage not granted.\");\n        }\n      )\n    },\n    getCurrentTabId (callback) {\n      chrome.tabs.query({\n        active: true,\n        currentWindow: true\n      }, function (tabs) {\n        if (callback) {\n          callback(tabs.length ? tabs[0].id : null)\n        }\n      })\n    },\n    sendMessageToContentScript (message, callback) {\n      console.log('in sendMessageToContentScript: ', message)\n      this.getCurrentTabId(tabId => {\n        console.log('in getCurrentTabId: ', tabId)\n        chrome.tabs.sendMessage(tabId, message, function (response) {\n          console.log('chrome tabs sendMessage: ', message)\n          if (callback) {\n            callback(response)\n          }\n        })\n      })\n    },\n    initFiler () {\n      return new Promise(resolve => {\n        if (this.filer) {\n          resolve(true)\n        } else {\n          this.filer = new Filer()\n          this.filer.init({}, function (fs) {\n            console.log('>>> init: ', fs)\n            resolve(true)\n          })\n        }\n      })\n    },\n    filerErrorCallback (e) {\n      console.log('filer error callback: ', e.name || e.message)\n    },\n    getHost (str) {\n      return 'www' + str.replace(/([^\\.]*)(\\.[a-z0-9-]*\\.(ac.cn|bj.cn|sh.cn|tj.cn|cq.cn|he.cn|sn.cn|sx.cn|nm.cn|ln.cn|jl.cn|hl.cn|js.cn|zj.cn|ah.cn|fj.cn|jx.cn|sd.cn|ha.cn|hb.cn|hn.cn|gd.cn|gx.cn|hi.cn|sc.cn|gz.cn|yn.cn|gs.cn|qh.cn|nx.cn|xj.cn|tw.cn|hk.cn|mo.cn|xz.cn|com.cn|net.cn|org.cn|gov.cn|.com.hk|我爱你|在线|中国|网址|网店|中文网|公司|网络|集团|com|cn|cc|org|net|xin|xyz|vip|shop|top|club|wang|fun|info|online|tech|store|site|ltd|ink|biz|group|link|work|pro|mobi|ren|kim|name|tv|red|cool|team|live|pub|company|zone|today|video|art|chat|gold|guru|show|life|love|email|fund|city|plus|design|social|center|world|auto|.rip|.ceo|.sale|.hk|.io|.gg|.tm|.gs|.us))(.*)/, '$2')\n    },\n    imgLoadError (e) {\n      e.target.setAttribute('src', '/static/images/earth.png')\n    },\n    openModal (e) {\n      this.activeIndex = Number(e.target.dataset.index)\n      this.cardModal.shown = true\n      this.cardModal.data = JSON.parse(JSON.stringify(this.userScripts[this.activeIndex]))\n      this.beautifyCode()\n    },\n    closeModal () {\n      this.cardModal.shown = false\n    },\n    confirmModify (e) {\n      this.userScripts.splice(this.activeIndex, 1, this.cardModal.data)\n      this.resetCardModal()\n      this.saveUserScripts()\n      this.$Message.success('修改成功')\n    },\n    resetCardModal () {\n      this.cardModal.data = {}\n      this.saveUserScripts()\n    },\n    async removeScript (e) {\n      this.cardModal.data.scripts.splice(Number(e.target.dataset.index), 1)\n      await this.saveUserScripts()\n    },\n    addScript (e) {\n      this.cardModal.data.scripts.push('')\n    },\n    removeUserScriptCard (e) {\n      e.stopPropagation()\n      this.$Modal.confirm({\n        title: '删除脚本',\n        content: '脚本删除后将不可恢复，是否确定删除',\n        okText: '确定',\n        cancelText: '再想想',\n        onOk: () => {\n          this.userScripts.splice(Number(e.target.dataset.index), 1)\n          this.saveUserScripts()\n          this.$Message.success('删除成功')\n        }\n      })\n    },\n    createNewCard () {\n      this.userScripts.push(JSON.parse(JSON.stringify(this.blankScript)))\n      this.openModal({\n        target: {\n          dataset: {\n            index: this.userScripts.length - 1\n          }\n        }\n      })\n    },\n    toggleUserScriptStatus (e) {\n      e.stopPropagation()\n      let _index = Number(e.target.dataset.index)\n      this.userScripts[_index].active = !this.userScripts[_index].active\n    },\n    async saveUserScripts () {\n      await StorageUtil.setItem(this.localStorageKeys.userScripts, this.userScripts)\n    }\n  }\n}\n</script>\n\n\n// WEBPACK FOOTER //\n// src/components/tool/Scripts.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"scripts_container\",style:(_vm.scriptsContainerStyles)},[_c('div',{staticClass:\"scripts_inner\",style:(_vm.scriptsInnerStyles)},[_vm._l((_vm.userScripts),function(item,index){return _c('Card',{key:index,staticClass:\"user_script_item\",attrs:{\"bordered\":false}},[_c('div',{staticClass:\"user_script_card_inner\",attrs:{\"data-index\":index},on:{\"click\":_vm.openModal}},[_c('img',{staticClass:\"site_favicon_img pen\",attrs:{\"src\":'http://' + _vm.getHost(item.match) + '/favicon.ico'},on:{\"error\":_vm.imgLoadError}}),_vm._v(\" \"),_c('Tooltip',{staticClass:\"pen\",class:{pen: !item.desc},attrs:{\"content\":item.desc,\"placement\":\"bottom\",\"transfer\":true,\"max-width\":250}},[_c('div',{staticClass:\"user_script_card_desc pea\",attrs:{\"data-index\":index},on:{\"click\":_vm.openModal}},[_vm._v(_vm._s(item.desc || '暂无描述'))])]),_vm._v(\" \"),_c('div',{staticClass:\"script_card_operations\"},[_c('Tooltip',{staticClass:\"delete_script_card\",attrs:{\"content\":\"删除脚本\",\"placement\":\"bottom\",\"transfer\":true}},[_c('Icon',{attrs:{\"type\":\"md-trash\",\"color\":\"#ed4014\",\"size\":\"18\",\"data-index\":index},on:{\"click\":_vm.removeUserScriptCard}})],1),_vm._v(\" \"),_c('Tooltip',{staticClass:\"delete_script_card\",attrs:{\"content\":item.active ? '关闭脚本' : '开启脚本',\"placement\":\"bottom\",\"transfer\":true}},[_c('Icon',{attrs:{\"type\":\"ios-bulb\",\"color\":item.active ? 'lightgray' : '#19be6b',\"size\":\"18\",\"data-index\":index},on:{\"click\":_vm.toggleUserScriptStatus}})],1)],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"user_script_card_item_status pen\",class:{active: item.active}},[_c('div',{staticClass:\"status_text\"},[_vm._v(_vm._s(item.active ? 'ON' : 'OFF'))])])])}),_vm._v(\" \"),_c('Card',{staticClass:\"user_script_item\",attrs:{\"bordered\":false}},[_c('div',{staticClass:\"user_script_card_inner\",on:{\"click\":_vm.createNewCard}},[_c('Icon',{attrs:{\"type\":\"md-add\",\"size\":\"50\"}})],1)])],2),_vm._v(\" \"),_c('Modal',{attrs:{\"title\":\"修改\",\"fullscreen\":true},on:{\"on-ok\":_vm.confirmModify,\"on-cancel\":_vm.resetCardModal},model:{value:(_vm.cardModal.shown),callback:function ($$v) {_vm.$set(_vm.cardModal, \"shown\", $$v)},expression:\"cardModal.shown\"}},[_c('div',{staticClass:\"code_container\"},[_c('div',{ref:_vm.codeContainerRef,staticClass:\"code_preview\"})])])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7d745097\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/tool/Scripts.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7d745097\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Scripts.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Scripts.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Scripts.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7d745097\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Scripts.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-7d745097\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/tool/Scripts.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}