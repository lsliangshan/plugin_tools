webpackJsonp([24],{HFPU:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("//Fk"),a=n.n(r),s=n("mvHQ"),c=n.n(s),i=n("woOf"),o=n.n(i),d=n("Xxa5"),l=n.n(d),u=n("exGp"),p=n.n(u),f=n("0xDb"),h={name:"scripts",data:function(){return{filer:null,codeContainerRef:"code-container-ref",blankScript:{match:"",desc:"",author:"",scripts:"/**\n* @author\t{{{AUTHOR}}}\n* @match\t{{{MATCH}}}\n* @desc \t{{{DESC}}}\n*/\n\n(function () {\n\t// 输入代码...\n})()\n",active:!1},userScripts:[],cardModal:{shown:!1,data:{}},activeIndex:-1,markdownContent:"",editor:{}}},computed:{bodyStyles:function(){return this.$store.state.bodyStyles},scriptsContainerStyles:function(){return{height:this.bodyStyles.height-65+"px"}},scriptsInnerStyles:function(){return{height:this.bodyStyles.height-65+"px"}},localStorageKeys:function(){return this.$store.state.localStorageKeys}},created:function(){var t=this;return p()(l.a.mark(function e(){var n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.next=3,f.b.getItem(t.localStorageKeys.userScripts);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:t.userScripts=e.t0,r="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform,t.$nextTick(function(){window.onkeydown=function(t){"scripts"===n.$route.name&&(r?t.metaKey&&83===t.keyCode&&(n.confirmModify(),n.closeModal(),t.preventDefault()):t.ctrlKey&&83===t.keyCode&&(n.confirmModify(),n.closeModal(),t.preventDefault()))},chrome.runtime.onMessage.addListener(function(t,e,r){if("userscript"===t.action){var a=n.getScritps({location:t.location});a.length>0&&r(a)}})});case 9:case"end":return e.stop()}},e,t)}))()},mounted:function(){},methods:{getScritps:function(t){for(var e=this.userScripts,n=[],r=0;r<e.length;r++)e[r].match&&""!==e[r].match.trim()&&e[r].active&&e[r].match.split(";").some(function(e){return t.location.match(e.replace(/\*/g,".*"))})&&n.push(e[r]);return n},formatScripts:function(t){return t.replace(/{{{AUTHOR}}}/,"YOU").replace(/{{{MATCH}}}/,this.cardModal.data.match).replace(/{{{DESC}}}/,this.cardModal.data.desc)},getScriptsConfig:function(){var t=this.cardModal.data.scripts.replace(/[\r\n]/g,"###");this.cardModal.data.author=t.replace(/(.*@author\s+)([^(###)]*)(###.*)/,"$2"),this.cardModal.data.match=t.replace(/(.*@match\s+)([^(###)]*)(###.*)/,"$2"),this.cardModal.data.desc=t.replace(/(.*@desc\s+)([^(###)]*)(###.*)/,"$2")},beautifyCode:function(){var t=this,e=this;setTimeout(function(){var r=t.$refs[t.codeContainerRef];r.innerHTML="",n.e(31).then(function(){var t=[n("8U58"),n("5IAE"),n("Z6qg"),n("THjC"),n("Kk9m"),n("dxBS"),n("TQy8"),n("soCA"),n("fo6W"),n("aX1R"),n("+/ra"),n("DpZM"),n("7Xsf")];(function(t){e.editor=t(r,o()({value:e.cardModal.data.scripts||e.formatScripts(e.blankScript.scripts)},{theme:"zenburn",mode:"javascript",lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,foldGutter:!0,matchBrackets:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchTags:{bothTags:!0},keyMap:"sublime"})),e.editor.on("change",function(t){e.cardModal.data.scripts=t.doc.getValue(),e.getScriptsConfig()})}).apply(null,t)}).catch(n.oe)},10)},saveData:function(t){var e=this;navigator.webkitPersistentStorage.requestQuota(5242880,function(n){window.webkitRequestFileSystem(window.PERSISTENT,5242880,function(n){n.root.getFile("userScripts.txt",{create:!0},function(n){n.createWriter(function(n){n.onwriteend=function(e){console.log("write completed.",e),t&&t()},n.onerror=function(t){console.log("write failed: "+t.toString())};var r=new Blob([c()(e.userScripts)],{type:"text/plain"});n.write(r)},function(t){console.log("create wirter error: ",t.toString())})},function(t){console.log("error: ",t.toString())})},function(t){console.log("webkitRequestFileSystem error: ",t.toString())})},function(t){alert("Storage not granted.")})},getCurrentTabId:function(t){chrome.tabs.query({active:!0,currentWindow:!0},function(e){t&&t(e.length?e[0].id:null)})},sendMessageToContentScript:function(t,e){console.log("in sendMessageToContentScript: ",t),this.getCurrentTabId(function(n){console.log("in getCurrentTabId: ",n),chrome.tabs.sendMessage(n,t,function(n){console.log("chrome tabs sendMessage: ",t),e&&e(n)})})},initFiler:function(){var t=this;return new a.a(function(e){t.filer?e(!0):(t.filer=new Filer,t.filer.init({},function(t){console.log(">>> init: ",t),e(!0)}))})},filerErrorCallback:function(t){console.log("filer error callback: ",t.name||t.message)},getHost:function(t){return"www"+t.replace(/([^\.]*)(\.[a-z0-9-]*\.(ac.cn|bj.cn|sh.cn|tj.cn|cq.cn|he.cn|sn.cn|sx.cn|nm.cn|ln.cn|jl.cn|hl.cn|js.cn|zj.cn|ah.cn|fj.cn|jx.cn|sd.cn|ha.cn|hb.cn|hn.cn|gd.cn|gx.cn|hi.cn|sc.cn|gz.cn|yn.cn|gs.cn|qh.cn|nx.cn|xj.cn|tw.cn|hk.cn|mo.cn|xz.cn|com.cn|net.cn|org.cn|gov.cn|.com.hk|我爱你|在线|中国|网址|网店|中文网|公司|网络|集团|com|cn|cc|org|net|xin|xyz|vip|shop|top|club|wang|fun|info|online|tech|store|site|ltd|ink|biz|group|link|work|pro|mobi|ren|kim|name|tv|red|cool|team|live|pub|company|zone|today|video|art|chat|gold|guru|show|life|love|email|fund|city|plus|design|social|center|world|auto|.rip|.ceo|.sale|.hk|.io|.gg|.tm|.gs|.us))(.*)/,"$2")},imgLoadError:function(t){t.target.setAttribute("src","/static/images/earth.png")},openModal:function(t){this.activeIndex=Number(t.target.dataset.index),this.cardModal.shown=!0,this.cardModal.data=JSON.parse(c()(this.userScripts[this.activeIndex])),this.beautifyCode()},closeModal:function(){this.cardModal.shown=!1},confirmModify:function(t){this.userScripts.splice(this.activeIndex,1,this.cardModal.data),this.resetCardModal(),this.saveUserScripts(),this.$Message.success("修改成功")},resetCardModal:function(){this.cardModal.data={},this.saveUserScripts()},removeScript:function(t){var e=this;return p()(l.a.mark(function n(){return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.cardModal.data.scripts.splice(Number(t.target.dataset.index),1),n.next=3,e.saveUserScripts();case 3:case"end":return n.stop()}},n,e)}))()},addScript:function(t){this.cardModal.data.scripts.push("")},removeUserScriptCard:function(t){var e=this;t.stopPropagation(),this.$Modal.confirm({title:"删除脚本",content:"脚本删除后将不可恢复，是否确定删除",okText:"确定",cancelText:"再想想",onOk:function(){e.userScripts.splice(Number(t.target.dataset.index),1),e.saveUserScripts(),e.$Message.success("删除成功")}})},createNewCard:function(){this.userScripts.push(JSON.parse(c()(this.blankScript))),this.openModal({target:{dataset:{index:this.userScripts.length-1}}})},toggleUserScriptStatus:function(t){t.stopPropagation();var e=Number(t.target.dataset.index);this.userScripts[e].active=!this.userScripts[e].active},saveUserScripts:function(){var t=this;return p()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.b.setItem(t.localStorageKeys.userScripts,t.userScripts);case 2:case"end":return e.stop()}},e,t)}))()}}},g={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"scripts_container",style:t.scriptsContainerStyles},[n("div",{staticClass:"scripts_inner",style:t.scriptsInnerStyles},[t._l(t.userScripts,function(e,r){return n("Card",{key:r,staticClass:"user_script_item",attrs:{bordered:!1}},[n("div",{staticClass:"user_script_card_inner",attrs:{"data-index":r},on:{click:t.openModal}},[n("img",{staticClass:"site_favicon_img pen",attrs:{src:"http://"+t.getHost(e.match)+"/favicon.ico"},on:{error:t.imgLoadError}}),t._v(" "),n("Tooltip",{staticClass:"pen",class:{pen:!e.desc},attrs:{content:e.desc,placement:"bottom",transfer:!0,"max-width":250}},[n("div",{staticClass:"user_script_card_desc pea",attrs:{"data-index":r},on:{click:t.openModal}},[t._v(t._s(e.desc||"暂无描述"))])]),t._v(" "),n("div",{staticClass:"script_card_operations"},[n("Tooltip",{staticClass:"delete_script_card",attrs:{content:"删除脚本",placement:"bottom",transfer:!0}},[n("Icon",{attrs:{type:"md-trash",color:"#ed4014",size:"18","data-index":r},on:{click:t.removeUserScriptCard}})],1),t._v(" "),n("Tooltip",{staticClass:"delete_script_card",attrs:{content:e.active?"关闭脚本":"开启脚本",placement:"bottom",transfer:!0}},[n("Icon",{attrs:{type:"ios-bulb",color:e.active?"lightgray":"#19be6b",size:"18","data-index":r},on:{click:t.toggleUserScriptStatus}})],1)],1)],1),t._v(" "),n("div",{staticClass:"user_script_card_item_status pen",class:{active:e.active}},[n("div",{staticClass:"status_text"},[t._v(t._s(e.active?"ON":"OFF"))])])])}),t._v(" "),n("Card",{staticClass:"user_script_item",attrs:{bordered:!1}},[n("div",{staticClass:"user_script_card_inner",on:{click:t.createNewCard}},[n("Icon",{attrs:{type:"md-add",size:"50"}})],1)])],2),t._v(" "),n("Modal",{attrs:{title:"修改",fullscreen:!0},on:{"on-ok":t.confirmModify,"on-cancel":t.resetCardModal},model:{value:t.cardModal.shown,callback:function(e){t.$set(t.cardModal,"shown",e)},expression:"cardModal.shown"}},[n("div",{staticClass:"code_container"},[n("div",{ref:t.codeContainerRef,staticClass:"code_preview"})])])],1)},staticRenderFns:[]};var m=n("VU/8")(h,g,!1,function(t){n("iz9H")},"data-v-7d745097",null);e.default=m.exports},iz9H:function(t,e){}});
//# sourceMappingURL=24.55863f9ce833a7d3d5cf.js.map